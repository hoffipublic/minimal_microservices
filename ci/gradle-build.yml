platform: linux

image_resource:
  type: docker-image
  source:
    repository: java
    tag: 8-jdk

# inputs and outputs (folders) can not(!) overlap (they are "on the same filesystem hierarchy level")
# if you want something that is generated by the run step to be available to following tasks,
# you have to copy them as part of the run step
inputs:
- name: git-source-code

outputs: # creates a dir in the docker-image to pass on files of this task to next ones
- name: buildFiles

caches:
  - path: git-source-code/.gradle/

run:
  path: "/bin/bash"
  dir: "git-source-code"
  args:
  - "-c"
  - |
    export BUILD_ROOT=$( pwd )
    export GRADLE_USER_HOME="${BUILD_ROOT}/.gradle"
    ./gradlew build -x test
    ls -lhF build/libs
    cp -r build/* ../buildFiles/
